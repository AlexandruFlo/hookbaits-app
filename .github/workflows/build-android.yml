name: ğŸš€ Build HOOKBAITS App (100% Functional)

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4

      - name: â˜• Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: ğŸ¦‹ Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          flutter-version: '3.22.2'

      - name: ğŸ”§ Create Base Flutter Project
        working-directory: public_html
        run: |
          flutter create temp_app --org com.hookbaits --project-name hookbaits_shop --platforms=android

      - name: ğŸ“ Copy Real App Code
        working-directory: public_html
        run: |
          # CopiazÄƒ TOATE fiÈ™ierele aplicaÈ›iei reale
          echo "ğŸ“‚ Copiez lib folder..."
          cp -r mobile_app/lib/* temp_app/lib/
          
          echo "ğŸ–¼ï¸ Copiez assets folder..."
          mkdir -p temp_app/assets
          cp -r mobile_app/assets/* temp_app/assets/
          
          echo "ğŸ“‹ Copiez pubspec.yaml..."
          cp mobile_app/pubspec.yaml temp_app/pubspec.yaml
          
          echo "ğŸ” VerificÄƒ assets copiaÈ›i..."
          ls -la temp_app/assets/
          
      - name: ğŸ“¦ Install Dependencies
        working-directory: public_html/temp_app
        run: |
          flutter pub get
          
      - name: ğŸ¨ Generate App Icons (Hook Logo on Black)
        working-directory: public_html/temp_app
        run: |
          echo "ğŸ¯ VerificÄƒ structura proiectului..."
          pwd
          ls -la
          
          echo "ğŸ–¼ï¸ VerificÄƒ fiÈ™ierele assets..."
          ls -la assets/ || echo "âŒ Folderul assets nu existÄƒ!"
          
          echo "ğŸ“‹ VerificÄƒ pubspec.yaml..."
          cat pubspec.yaml | grep -A 10 flutter_launcher_icons || echo "âŒ ConfiguraÈ›ia flutter_launcher_icons lipseÈ™te!"
          
          echo "ğŸ“¦ AdaugÄƒ flutter_launcher_icons..."
          flutter pub add flutter_launcher_icons
          
          echo "ğŸ¨ GenereazÄƒ iconiÈ›a HOOKBAITS cu fundal negru..."
          if [ -f "assets/logo.png" ]; then
            echo "âœ… Logo-ul Hook gÄƒsit, generez iconiÈ›a..."
            flutter pub run flutter_launcher_icons:main
            echo "ğŸ” VerificÄƒ iconiÈ›ele generate..."
            find android/app/src/main/res -name "*launcher*" -type f | head -10
            echo "âœ… IconiÈ›a HOOKBAITS cu logo pe fundal negru a fost generatÄƒ!"
          else
            echo "âŒ EROARE: assets/logo.png nu existÄƒ!"
            echo "ğŸ“ ConÈ›inutul folderului assets:"
            ls -la assets/ || echo "Folderul assets nu existÄƒ deloc!"
            exit 1
          fi

      - name: ğŸ”¨ Build APK (With Real Code)
        working-directory: public_html/temp_app
        env:
          BASE_URL: ${{ secrets.BASE_URL }}
        run: |
          if [ -z "$BASE_URL" ]; then BASE_URL=https://hookbaits.ro; fi
          flutter build apk --release --dart-define=BASE_URL=$BASE_URL

      - name: ğŸ“¤ Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: hookbaits-app-100-functional
          path: public_html/temp_app/build/app/outputs/**/*.apk
