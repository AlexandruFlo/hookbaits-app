name: ğŸš€ Build HOOKBAITS App (100% Functional)

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4

      - name: â˜• Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: ğŸ¦‹ Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          flutter-version: '3.22.2'

      - name: ğŸ”§ Create Base Flutter Project
        working-directory: public_html
        run: |
          flutter create temp_app --org com.hookbaits --project-name hookbaits_shop --platforms=android

      - name: ğŸ“ Copy Real App Code
        working-directory: public_html
        run: |
          # CopiazÄƒ TOATE fiÈ™ierele aplicaÈ›iei reale
          cp -r mobile_app/lib/* temp_app/lib/
          cp -r mobile_app/assets/* temp_app/assets/ 2>/dev/null || mkdir -p temp_app/assets
          cp mobile_app/pubspec.yaml temp_app/pubspec.yaml
          
      - name: ğŸ“¦ Install Dependencies
        working-directory: public_html/temp_app
        run: |
          flutter pub get
          
      - name: ğŸ¨ Generate App Icons (Hook Logo on Black)
        working-directory: public_html/temp_app
        run: |
          echo "ğŸ¯ VerificÄƒ fiÈ™ierele assets..."
          ls -la assets/
          
          echo "ğŸ“¦ AdaugÄƒ flutter_launcher_icons..."
          flutter pub add flutter_launcher_icons
          
          echo "ğŸ¨ GenereazÄƒ iconiÈ›a HOOKBAITS cu fundal negru..."
          flutter pub run flutter_launcher_icons:main
          
          echo "ğŸ” VerificÄƒ iconiÈ›ele generate..."
          find android/app/src/main/res -name "*launcher*" -type f | head -10
          
          echo "âœ… IconiÈ›a HOOKBAITS cu logo pe fundal negru a fost generatÄƒ!"

      - name: ğŸ”¨ Build APK (With Real Code)
        working-directory: public_html/temp_app
        env:
          BASE_URL: ${{ secrets.BASE_URL }}
        run: |
          if [ -z "$BASE_URL" ]; then BASE_URL=https://hookbaits.ro; fi
          flutter build apk --release --dart-define=BASE_URL=$BASE_URL

      - name: ğŸ“¤ Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: hookbaits-app-100-functional
          path: public_html/temp_app/build/app/outputs/**/*.apk
